<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
    {% load js %}
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,300&display=swap"
      rel="stylesheet"
    />
    <title>Poke App</title>
  </head>
  <body>
    <header>
      <div class="nav-bar">
        <div class="content">
          <div class="title"><h1>Bienvenido a Pokes</h1></div>
          <div class="btn-container">
            <form
              method="POST"
              enctype="multipart/form-data"
              class="upload-bpmn"
            >
              {% csrf_token %}
              <input
                class="select-bpmn-btn"
                type="file"
                id="myFile"
                name="myFile"
              />
              <input class="submit-bpmn-btn" type="submit" />
            </form>
          </div>
        </div>
      </div>
    </header>
    <div
      style="display: none; justify-content: center; margin: 40px 40px 0px 40px"
      class="navigation-btns"
    >
      <button class="previous-btn" style="margin: 10px">back</button>
      <button class="next-btn" style="margin: 10px">next</button>
    </div>
    <div
      style="
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 40px;
      "
      class="app-container"
    ></div>
    <br />

    <script>
      // Funciones
      const renderView = (stringView, viewContainer) => {
        viewContainer.innerHTML = stringView;
      };

      const handleFormSubmission = (form) => {
        Array.from(form).map((element, idx) => {
          console.dir(element);
          console.dir(element.type);

          switch (element.type) {
            case "radio":
              console.dir(element.name);
              console.log(element.value);
              console.log(element.checked);
              break;

            case "checkbox":
              console.dir(element.name);
              console.log(element.value);
              console.log(element.checked);
              break;

            case "text":
              console.log(element.tagName);
              console.log(element.value);
              break;

            case "email":
              console.log(element.value);
              break;

            case "password":
              console.log(element.value);
              console.log(element.tagName);
              break;

            case "date":
              console.log(element.valueAsDate);
              break;

            case "time":
              console.log(element.valueAsDate);
              break;
            default:
              break;
          }
        });
      };

      const nextForm = () => {
        const lastForm = document.querySelector(`#formulario${idx}`);

        idx += idx <= contextLength ? 1 : 0;
        let nextView = `formulario${idx}`;

        if (app[nextView] !== undefined) {
          handleFormSubmission(lastForm);
          renderView(app[nextView], appContainer);
        }else{
          gate += gate <= gatewayLength ? 1 : 0;
          
          if(condicion)
            nextView = `formulario${idx}GateWay${gate}`
            nextView = `formulario${idx}GateWay${gate}`
            if (app[nextView] !== undefined) {
              handleFormSubmission(lastForm);
              renderView(app[nextView], appContainer);
          }
          

        }

        if (idx === +contextLength + 1) {
          handleFormSubmission(lastForm);
          renderView(
            '<h1 class="success-notification">Formulario completado exitosamente</h1>',
            appContainer
          );
        }
      };

      const prevForm = () => {
        idx -= idx > 1 ? 1 : 0;
        let previousView = `formulario${idx}`;
        if (app[previousView] !== undefined) {
          renderView(app[previousView], appContainer);
        }
      };

      // Contenedor de la aplicaci칩n
      var appContainer = document.querySelector(".app-container");

      // Botones de navegaci칩n
      const prevBtn = document.querySelector(".previous-btn");
      const nextBtn = document.querySelector(".next-btn");

      // Aplicaci칩n parseada desde el template context de Django
      const app = JSON.parse(`{{ application | js }}`);
      const contextLength = "{{ application | length }}";
      const gatewayLength = "{{ gateway | length }}"

      let idx = 1;
      let gate = 0;
      let firstView = `formulario${idx}`;

      // Si el tama침o del objeto app es diferente de 0 (hay datos que mostrar) entonces muestra los datos
      if (Object.keys(app).length !== 0 && app.constructor === Object) {
        document.querySelector(".navigation-btns").style.display = "flex";
        appContainer.innerHTML = app[firstView];
      }

      // Manejador de eventos (click) proximo y anterior
      nextBtn.addEventListener("click", nextForm);
      prevBtn.addEventListener("click", prevForm);
    </script>
  </body>
</html>
